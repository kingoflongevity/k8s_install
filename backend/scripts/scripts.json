{
  "almalinux_安装kubernetes组件": "# 安装Kubernetes组件\n# 确保kubelet、kubeadm、kubectl版本与Kubernetes版本一致\nsudo dnf install -y kubelet${version} kubeadm${version} kubectl${version} --disableexcludes=kubernetes\n\n# 添加master主机名解析\nsudo echo \"127.0.0.1 master\" >> /etc/hosts\n\n# 重启containerd和kubelet服务\nsudo systemctl restart containerd kubelet\n\n# 启动kubelet\nsudo systemctl enable --now kubelet",
  "almalinux_安装容器运行时": "# 安装containerd\nsudo dnf install -y containerd.io\n\n# 配置containerd\nsudo systemctl stop containerd || true\nsleep 2\nsudo rm -rf /run/containerd /var/lib/containerd /var/run/containerd\nsudo mkdir -p /etc/containerd /run/containerd /var/lib/containerd\nsudo containerd config default \u003e /etc/containerd/config.toml\nsudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml\nsudo sed -i 's/disabled_plugins = \["cri"\]/disabled_plugins = \[\]/' /etc/containerd/config.toml\n\n# 启动containerd\nsudo systemctl daemon-reexec\nsudo systemctl enable --now containerd",
  "almalinux_添加kubernetes仓库": "# 添加Kubernetes仓库\n# 清理旧的Kubernetes仓库配置\nsudo rm -f /etc/yum.repos.d/kubernetes.repo\nsudo rm -f /etc/yum.repos.d/packages.cloud.google.com_yum_repos_kubernetes-el7-x86_64.repo\n\n# 添加新的Kubernetes仓库\nsudo cat \u003c\u003cEOF \u003e /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://pkgs.k8s.io/core:/stable:/${version}/rpm/\nenabled=1\ngpgcheck=1\ngpgkey=https://pkgs.k8s.io/core:/stable:/${version}/rpm/repodata/repomd.xml.key\nexclude=kubelet kubeadm kubectl\nEOF\n\n# 更新仓库缓存\nsudo dnf makecache",
  "almalinux_系统准备": "# 禁用swap\nsudo swapoff -a\nsudo sed -i '/ swap / s/^/#/' /etc/fstab\n\n# 安装并启动时间同步服务\nsudo dnf install -y chrony\nsudo systemctl enable --now chronyd\nsudo timedatectl set-timezone Asia/Shanghai\n\n# 关闭防火墙\nsudo systemctl stop firewalld || true\nsudo systemctl disable firewalld || true\n\n# 禁用SELinux\nsudo setenforce 0\nsudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\n\n# 加载K8s所需内核模块\ncat \u003c\u003cEOF \u003e /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\nsudo modprobe overlay\nsudo modprobe br_netfilter\n\n# 设置内核参数\n# 使用EOF方式写入IP转发配置文件\ncat \u003c\u003cEOF \u003e /etc/sysctl.d/99-kubernetes-ipforward.conf\nnet.ipv4.ip_forward = 1\nEOF\n\n# 设置其他Kubernetes所需内核参数\ncat \u003c\u003cEOF \u003e /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n\n# 应用内核参数\nsudo sysctl --system",
  "centos_安装kubernetes组件": "# 安装Kubernetes组件\n# 确保kubelet、kubeadm、kubectl版本与Kubernetes版本一致\nsudo yum install -y kubelet${version} kubeadm${version} kubectl${version} --disableexcludes=kubernetes\n\n# 添加master主机名解析\nsudo echo \"127.0.0.1 master\" >> /etc/hosts\n\n# 重启containerd和kubelet服务\nsudo systemctl restart containerd kubelet\n\n# 启动kubelet\nsudo systemctl enable --now kubelet",
  "centos_安装容器运行时": "# 安装containerd\nsudo yum install -y containerd.io\n\n# 配置containerd\nsudo systemctl stop containerd || true\nsleep 2\nsudo rm -rf /run/containerd /var/lib/containerd /var/run/containerd\nsudo mkdir -p /etc/containerd /run/containerd /var/lib/containerd\nsudo containerd config default \u003e /etc/containerd/config.toml\nsudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml\nsudo sed -i 's/disabled_plugins = \["cri"\]/disabled_plugins = \[\]/' /etc/containerd/config.toml\n\n# 启动containerd\nsudo systemctl daemon-reexec\nsudo systemctl enable --now containerd",
  "centos_添加kubernetes仓库": "# 添加Kubernetes仓库\n# 清理旧的Kubernetes仓库配置\nsudo rm -f /etc/yum.repos.d/kubernetes.repo\nsudo rm -f /etc/yum.repos.d/packages.cloud.google.com_yum_repos_kubernetes-el7-x86_64.repo\n\n# 添加新的Kubernetes仓库\nsudo cat \u003c\u003cEOF \u003e /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://pkgs.k8s.io/core:/stable:/${version}/rpm/\nenabled=1\ngpgcheck=1\ngpgkey=https://pkgs.k8s.io/core:/stable:/${version}/rpm/repodata/repomd.xml.key\nexclude=kubelet kubeadm kubectl\nEOF\n\n# 更新仓库缓存\nsudo yum makecache",
  "centos_系统准备": "# 禁用swap\nsudo swapoff -a\nsudo sed -i '/ swap / s/^/#/' /etc/fstab\n\n# 安装并启动时间同步服务\nsudo yum install -y chrony\nsudo systemctl enable --now chronyd\nsudo timedatectl set-timezone Asia/Shanghai\n\n# 关闭防火墙\nsudo systemctl stop firewalld || true\nsudo systemctl disable firewalld || true\n\n# 禁用SELinux\nsudo setenforce 0\nsudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\n\n# 加载K8s所需内核模块\ncat \u003c\u003cEOF \u003e /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\nsudo modprobe overlay\nsudo modprobe br_netfilter\n\n# 设置内核参数\n# 使用EOF方式写入IP转发配置文件\ncat \u003c\u003cEOF \u003e /etc/sysctl.d/99-kubernetes-ipforward.conf\nnet.ipv4.ip_forward = 1\nEOF\n\n# 设置其他Kubernetes所需内核参数\ncat \u003c\u003cEOF \u003e /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n\n# 应用内核参数\nsudo sysctl --system",
  "containerd_config": "# containerd配置脚本\necho \"=== 配置并启动containerd ===\"\n\n# 停止containerd服务\necho \"停止containerd服务...\"\nsystemctl stop containerd || true\nsleep 2\n\n# 彻底清理containerd运行时目录和数据\necho \"清理containerd运行时目录和数据...\"\nrm -rf /run/containerd /var/lib/containerd /var/run/containerd\nmkdir -p /etc/containerd /run/containerd /var/lib/containerd\n\n# 生成默认配置，覆盖现有配置以确保正确性\necho \"生成containerd默认配置...\"\ncontainerd config default | tee /etc/containerd/config.toml\n\n# 确保使用systemd cgroup驱动\necho \"设置systemd cgroup驱动...\"\nsed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml\n\n# 确保CRI插件没有被禁用\necho \"确保CRI插件没有被禁用...\"\nsed -i 's/disabled_plugins = \[\"cri\"\]/disabled_plugins = \[\]/' /etc/containerd/config.toml\n\n# 重新加载systemd配置\necho \"重新加载systemd配置...\"\nsystemctl daemon-reexec\n\n# 启动并启用containerd服务\necho \"启动containerd服务...\"\nsystemctl enable --now containerd\n\n# 等待containerd启动，增加等待时间\necho \"等待containerd启动...\"\nsleep 10\n\n# 修正CRI端点配置\necho \"=== 修正CRI端点配置 ===\"\nsystemctl restart containerd kubelet && rm -f /etc/crictl.yaml && printf \"runtime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\n\" > /etc/crictl.yaml && crictl info\n\n# 检查containerd状态\necho \"=== 检查containerd状态 ===\"\nif command -v systemctl \u0026\u003e /dev/null; then\n    systemctl_status=$(systemctl is-active containerd)\n    echo \"containerd服务状态: $systemctl_status\"\n    \n    # 显示containerd服务详细状态\n    echo \"containerd服务详细状态:\"\n    systemctl status containerd --no-pager\nfi\n\n# 检查containerd socket是否存在\necho \"=== 检查containerd socket ===\"\ncri_socket=\"/run/containerd/containerd.sock\"\nif [ -S \"$cri_socket\" ]; then\n    echo \"CRI socket $cri_socket 存在\"\n    # 测试socket连接\n    echo \"测试containerd连接...\"\n    if command -v ctr \u0026\u003e /dev/null; then\n        ctr version\n    fi\n    \n    # 使用crictl验证CRI可用性（如果已安装）\n    echo \"验证CRI可用性...\"\n    if command -v crictl \u0026\u003e /dev/null; then\n        echo \"使用crictl测试CRI连接...\"\n        crictl info\n    else\n        echo \"crictl未安装，跳过CRI完整验证\"\n    fi\nelse\n    echo \"警告: CRI socket $cri_socket 不存在，检查containerd日志...\"\n    journalctl -u containerd --no-pager -n 30\n    \n    # 尝试手动启动containerd\n    echo \"尝试手动启动containerd...\"\n    containerd --version\n    containerd \u0026\n    containerd_pid=$!\n    sleep 5\n    \n    # 再次检查socket\n    if [ -S \"$cri_socket\" ]; then\n        echo \"手动启动成功，CRI socket $cri_socket 现在存在\"\n        # 测试手动启动的containerd\n        if command -v ctr \u0026\u003e /dev/null; then\n            ctr version\n        fi\n        # 杀掉手动启动的containerd进程，让systemd管理\n        kill $containerd_pid 2>/dev/null || true\n        sleep 2\n        systemctl restart containerd\n    else\n        echo \"手动启动失败，CRI socket $cri_socket 仍然不存在\"\n        # 杀掉手动启动的containerd进程\n        kill $containerd_pid 2>/dev/null || true\n    fi\nfi\n\n# 最终验证\necho \"=== 最终验证 ===\"\nif [ -S \"$cri_socket\" ]; then\n    echo \"✅ CRI socket $cri_socket 已成功创建，containerd配置完成\"\nelse\n    echo \"❌ CRI socket $cri_socket 仍未创建，containerd配置失败\"\n    exit 1\nfi",
  "containerd_install": "# containerd安装脚本\necho \"=== 安装containerd ===\"\nif ! command -v containerd \u0026\u003e /dev/null; then\n    echo \"containerd未安装，正在安装...\"\n    if command -v apt-get \u0026\u003e /dev/null; then\n        # Ubuntu/Debian系统\n        echo \"=== 使用apt-get安装containerd ===\"\n        apt update -y\n        apt install -y containerd\n    elif command -v dnf \u0026\u003e /dev/null; then\n        # CentOS/RHEL 8+系统\n        echo \"=== 使用dnf安装containerd ===\"\n        dnf install -y containerd\n    elif command -v yum \u0026\u003e /dev/null; then\n        # CentOS/RHEL 7系统\n        echo \"=== 使用yum安装containerd ===\"\n        yum install -y containerd\n    else\n        echo \"=== 警告: 不支持的包管理器，尝试手动安装containerd ===\"\n        # 尝试从GitHub下载并安装containerd\n        if command -v curl \u0026\u003e /dev/null \u0026\u0026 command -v tar \u0026\u003e /dev/null; then\n            CONTAINERD_VERSION=\"1.6.28\"\n            ARCH=\"amd64\"\n            echo \"从GitHub下载containerd v${CONTAINERD_VERSION}...\"\n            curl -L https://github.com/containerd/containerd/releases/download/v${CONTAINERD_VERSION}/containerd-${CONTAINERD_VERSION}-linux-${ARCH}.tar.gz -o /tmp/containerd.tar.gz\n            mkdir -p /usr/local/bin /usr/local/lib /etc/containerd\n            tar Cxzvf /usr/local /tmp/containerd.tar.gz\n            # 创建systemd服务文件\n            cat \u003e /etc/systemd/system/containerd.service \u003c\u003c-'EOF'\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/local/bin/containerd\nRestart=always\nRestartSec=5\nDelegate=yes\nKillMode=process\nOOMScoreAdjust=-999\nLimitNOFILE=1048576\nLimitNPROC=infinity\nLimitCORE=infinity\n\n[Install]\nWantedBy=multi-user.target\nEOF\n            systemctl daemon-reload\n            systemctl enable containerd\n        fi\n    fi\nfi",
  "debian_安装kubernetes组件": "# 安装Kubernetes组件\n# 确保kubelet、kubeadm、kubectl版本与Kubernetes版本一致\nsudo apt update -y\nsudo apt install -y kubelet${version} kubeadm${version} kubectl${version}\n\n# 添加master主机名解析\nsudo echo \"127.0.0.1 master\" >> /etc/hosts\n\n# 重启containerd和kubelet服务\nsudo systemctl restart containerd kubelet\n\n# 启动kubelet\nsudo systemctl enable --now kubelet",
  "debian_安装容器运行时": "# 安装containerd\nsudo apt update\nsudo apt install -y containerd.io\n\n# 配置containerd\nsudo systemctl stop containerd || true\nsleep 2\nsudo rm -rf /run/containerd /var/lib/containerd /var/run/containerd\nsudo mkdir -p /etc/containerd /run/containerd /var/lib/containerd\nsudo containerd config default \u003e /etc/containerd/config.toml\nsudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml\nsudo sed -i 's/disabled_plugins = \["cri"\]/disabled_plugins = \[\]/' /etc/containerd/config.toml\n\n# 启动containerd\nsudo systemctl daemon-reexec\nsudo systemctl enable --now containerd",
  "debian_添加kubernetes仓库": "# 添加Kubernetes仓库\nsudo apt update\nsudo apt install -y apt-transport-https ca-certificates curl gpg\n\n# 创建keyring目录\nsudo mkdir -p -m 755 /etc/apt/keyrings\n\n# 下载并安装GPG密钥\ncurl -fsSL -L https://pkgs.k8s.io/core:/stable:/${version}/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\n\n# 添加Kubernetes repo\necho \"deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/${version}/deb/ /\" | sudo tee /etc/apt/sources.list.d/kubernetes.list\n\n# 更新仓库缓存\nsudo apt update",
  "debian_系统准备": "# 禁用swap\nsudo swapoff -a\nsudo sed -i '/ swap / s/^/#/' /etc/fstab\n\n# 安装并启动时间同步服务\nsudo apt update\nsudo apt install -y chrony\nsudo systemctl enable --now chronyd\nsudo timedatectl set-timezone Asia/Shanghai\n\n# 关闭防火墙\nsudo systemctl stop ufw || true\nsudo systemctl disable ufw || true\n\n# 加载K8s所需内核模块\ncat \u003c\u003cEOF \u003e /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\nsudo modprobe overlay\nsudo modprobe br_netfilter\n\n# 设置内核参数\n# 使用EOF方式写入IP转发配置文件\ncat \u003c\u003cEOF \u003e /etc/sysctl.d/99-kubernetes-ipforward.conf\nnet.ipv4.ip_forward = 1\nEOF\n\n# 设置其他Kubernetes所需内核参数\ncat \u003c\u003cEOF \u003e /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n\n# 应用内核参数\nsudo sysctl --system",
  "k8s_components": "# Kubernetes组件安装脚本\necho \"=== 安装Kubernetes组件 ===\"\n\n# 处理版本号，移除v前缀（如果存在）\nKUBE_VERSION=${version}\nKUBE_VERSION=${KUBE_VERSION#v}  # 移除v前缀\n\n# 确保kubelet、kubeadm、kubectl版本与Kubernetes版本一致\nif command -v apt-get \u0026\u003e /dev/null; then\n    # Ubuntu/Debian系统\n    sudo apt-get update -y\n    sudo apt-get install -y kubelet=${version} kubeadm=${version} kubectl=${version}\n    # 添加master主机名解析\n    sudo echo \"127.0.0.1 master\" \u003e\u003e /etc/hosts\n    # 重启containerd和kubelet服务\n    sudo systemctl restart containerd kubelet\n    # 启动kubelet\n    sudo systemctl enable --now kubelet\nelif command -v dnf \u0026\u003e /dev/null; then\n    # CentOS/RHEL 8+系统\n    # 确保Kubernetes仓库已添加\n    if [ ! -f /etc/yum.repos.d/kubernetes.repo ]; then\n        echo \"=== 添加Kubernetes仓库 ===\"\n        sudo cat \u003c\u003cEOF \u003e /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\nexclude=kubelet kubeadm kubectl\nEOF\n        sudo dnf clean all\n        sudo dnf makecache -y\n    fi\n    \n    sudo dnf install -y kubelet-${KUBE_VERSION} kubeadm-${KUBE_VERSION} kubectl-${KUBE_VERSION} --disableexcludes=kubernetes\n    # 添加master主机名解析\n    sudo echo \"127.0.0.1 master\" \u003e\u003e /etc/hosts\n    # 重启containerd和kubelet服务\n    sudo systemctl restart containerd kubelet\n    # 启动kubelet\n    sudo systemctl enable --now kubelet\nelif command -v yum \u0026\u003e /dev/null; then\n    # CentOS/RHEL 7系统\n    # 确保Kubernetes仓库已添加\n    if [ ! -f /etc/yum.repos.d/kubernetes.repo ]; then\n        echo \"=== 添加Kubernetes仓库 ===\"\n        sudo cat \u003c\u003cEOF \u003e /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\nexclude=kubelet kubeadm kubectl\nEOF\n        sudo yum clean all\n        sudo yum makecache -y\n    fi\n    \n    sudo yum install -y kubelet-${KUBE_VERSION} kubeadm-${KUBE_VERSION} kubectl-${KUBE_VERSION} --disableexcludes=kubernetes\n    # 添加master主机名解析\n    sudo echo \"127.0.0.1 master\" \u003e\u003e /etc/hosts\n    # 重启containerd和kubelet服务\n    sudo systemctl restart containerd kubelet\n    # 启动kubelet\n    sudo systemctl enable --now kubelet\nfi",
  "rocky_安装kubernetes组件": "# 安装Kubernetes组件\n# 处理版本号，移除v前缀（如果存在）\nKUBE_VERSION=${version}\nKUBE_VERSION=${KUBE_VERSION#v}  # 移除v前缀\n\n# 确保kubelet、kubeadm、kubectl版本与Kubernetes版本一致\nsudo dnf install -y kubelet-${KUBE_VERSION} kubeadm-${KUBE_VERSION} kubectl-${KUBE_VERSION} --disableexcludes=kubernetes\n\n# 添加master主机名解析\nsudo echo \"127.0.0.1 master\" >> /etc/hosts\n\n# 重启containerd和kubelet服务\nsudo systemctl restart containerd kubelet\n\n# 启动kubelet\nsudo systemctl enable --now kubelet",
  "rocky_安装容器运行时": "# 安装containerd\nsudo dnf install -y containerd.io\n\n# 配置containerd\nsudo systemctl stop containerd || true\nsleep 2\nsudo rm -rf /run/containerd /var/lib/containerd /var/run/containerd\nsudo mkdir -p /etc/containerd /run/containerd /var/lib/containerd\nsudo containerd config default \u003e /etc/containerd/config.toml\nsudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml\nsudo sed -i 's/disabled_plugins = \["cri"\]/disabled_plugins = \[\]/' /etc/containerd/config.toml\n\n# 启动containerd\nsudo systemctl daemon-reexec\nsudo systemctl enable --now containerd",
  "rocky_添加kubernetes仓库": "# 添加Kubernetes仓库\n# 清理旧的Kubernetes仓库配置\nsudo rm -f /etc/yum.repos.d/kubernetes.repo\nsudo rm -f /etc/yum.repos.d/packages.cloud.google.com_yum_repos_kubernetes-el7-x86_64.repo\n\n# 添加新的Kubernetes仓库\nsudo cat \u003c\u003cEOF \u003e /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://pkgs.k8s.io/core:/stable:/${version}/rpm/\nenabled=1\ngpgcheck=1\ngpgkey=https://pkgs.k8s.io/core:/stable:/${version}/rpm/repodata/repomd.xml.key\nexclude=kubelet kubeadm kubectl\nEOF\n\n# 更新仓库缓存\nsudo dnf makecache",
  "rocky_系统准备": "# 禁用swap\nsudo swapoff -a\nsudo sed -i '/ swap / s/^/#/' /etc/fstab\n\n# 安装并启动时间同步服务\nsudo dnf install -y chrony\nsudo systemctl enable --now chronyd\nsudo timedatectl set-timezone Asia/Shanghai\n\n# 关闭防火墙\nsudo systemctl stop firewalld || true\nsudo systemctl disable firewalld || true\n\n# 禁用SELinux\nsudo setenforce 0\nsudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\n\n# 加载K8s所需内核模块\ncat \u003c\u003cEOF \u003e /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\nsudo modprobe overlay\nsudo modprobe br_netfilter\n\n# 设置内核参数\n# 使用EOF方式写入IP转发配置文件\ncat \u003c\u003cEOF \u003e /etc/sysctl.d/99-kubernetes-ipforward.conf\nnet.ipv4.ip_forward = 1\nEOF\n\n# 设置其他Kubernetes所需内核参数\ncat \u003c\u003cEOF \u003e /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n\n# 应用内核参数\nsudo sysctl --system",
  "system_prep": "# 系统准备脚本\n# 禁用swap\nsudo swapoff -a\nsudo sed -i '/ swap / s/^/#/' /etc/fstab\n\n# 安装并启动时间同步服务\necho \"=== 安装并配置时间同步 ===\"\nif command -v apt-get \u0026\u003e /dev/null; then\n    sudo apt update -y\n    sudo apt install -y chrony\n    sudo systemctl enable --now chronyd || sudo systemctl enable --now chrony\n    sudo timedatectl set-timezone Asia/Shanghai\n    sudo systemctl restart chronyd || sudo systemctl restart chrony\n    chronyc sources\nelif command -v dnf \u0026\u003e /dev/null || command -v yum \u0026\u003e /dev/null; then\n    if command -v dnf \u0026\u003e /dev/null; then\n        sudo dnf install -y chrony\n    else\n        sudo yum install -y chrony\n    fi\n    sudo systemctl enable --now chronyd\n    sudo timedatectl set-timezone Asia/Shanghai\n    sudo systemctl restart chronyd || sudo systemctl restart chrony\n    chronyc sources\nfi\n\n# 关闭防火墙（实验环境建议关闭）\necho \"=== 配置防火墙 ===\"\nif command -v ufw \u0026\u003e /dev/null; then\n    sudo systemctl stop ufw || true\n    sudo systemctl disable ufw || true\nelif command -v firewall-cmd \u0026\u003e /dev/null; then\n    sudo systemctl stop firewalld || true\n    sudo systemctl disable firewalld || true\nfi\n\n# 禁用SELINUX（仅适用于RHEL/CentOS系统）\necho \"=== 配置SELinux ===\"\nif command -v setenforce \u0026\u003e /dev/null; then\n    sudo setenforce 0 2\u003e/dev/null || true\n    sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config 2\u003e/dev/null || true\nfi\n\n# 加载K8s所需内核模块\necho \"=== 加载Kubernetes所需内核模块 ===\"\nsudo cat \u003c\u003cEOF \u003e /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\nsudo modprobe overlay\nsudo modprobe br_netfilter\n\n# 设置内核参数\necho \"=== 设置内核参数 ===\"\n# 使用EOF方式写入IP转发配置文件\nsudo cat \u003c\u003cEOF \u003e /etc/sysctl.d/99-kubernetes-ipforward.conf\nnet.ipv4.ip_forward = 1\nEOF\n\n# 设置其他Kubernetes所需内核参数\nsudo cat \u003c\u003cEOF \u003e /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n\nsudo sysctl --system\n\n# 验证内核参数设置\necho \"=== 验证内核参数 ===\"\nsudo sysctl net.bridge.bridge-nf-call-iptables net.bridge.bridge-nf-call-ip6tables net.ipv4.ip_forward",
  "ubuntu_安装kubernetes组件": "# 安装Kubernetes组件\n# 确保kubelet、kubeadm、kubectl版本与Kubernetes版本一致\nsudo apt update -y\nsudo apt install -y kubelet${version} kubeadm${version} kubectl${version}\n\n# 添加master主机名解析\nsudo echo \"127.0.0.1 master\" >> /etc/hosts\n\n# 重启containerd和kubelet服务\nsudo systemctl restart containerd kubelet\n\n# 启动kubelet\nsudo systemctl enable --now kubelet",
  "ubuntu_安装容器运行时": "# 安装containerd\nsudo apt update\nsudo apt install -y containerd.io\n\n# 配置containerd\nsudo systemctl stop containerd || true\nsleep 2\nsudo rm -rf /run/containerd /var/lib/containerd /var/run/containerd\nsudo mkdir -p /etc/containerd /run/containerd /var/lib/containerd\nsudo containerd config default \u003e /etc/containerd/config.toml\nsudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/g' /etc/containerd/config.toml\nsudo sed -i 's/disabled_plugins = \["cri"\]/disabled_plugins = \[\]/' /etc/containerd/config.toml\n\n# 启动containerd\nsudo systemctl daemon-reexec\nsudo systemctl enable --now containerd",
  "ubuntu_添加kubernetes仓库": "# 添加Kubernetes仓库\nsudo apt update\nsudo apt install -y apt-transport-https ca-certificates curl gpg\n\n# 创建keyring目录\nsudo mkdir -p -m 755 /etc/apt/keyrings\n\n# 下载并安装GPG密钥\ncurl -fsSL -L https://pkgs.k8s.io/core:/stable:/${version}/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg\n\n# 添加Kubernetes repo\necho \"deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/${version}/deb/ /\" | sudo tee /etc/apt/sources.list.d/kubernetes.list\n\n# 更新仓库缓存\nsudo apt update",
  "ubuntu_系统准备": "# 禁用swap\nsudo swapoff -a\nsudo sed -i '/ swap / s/^/#/' /etc/fstab\n\n# 安装并启动时间同步服务\nsudo apt update\nsudo apt install -y chrony\nsudo systemctl enable --now chronyd\nsudo timedatectl set-timezone Asia/Shanghai\n\n# 关闭防火墙\nsudo systemctl stop ufw || true\nsudo systemctl disable ufw || true\n\n# 加载K8s所需内核模块\ncat \u003c\u003cEOF \u003e /etc/modules-load.d/k8s.conf\noverlay\nbr_netfilter\nEOF\nsudo modprobe overlay\nsudo modprobe br_netfilter\n\n# 设置内核参数\n# 使用EOF方式写入IP转发配置文件\ncat \u003c\u003cEOF \u003e /etc/sysctl.d/99-kubernetes-ipforward.conf\nnet.ipv4.ip_forward = 1\nEOF\n\n# 设置其他Kubernetes所需内核参数\ncat \u003c\u003cEOF \u003e /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-iptables = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF\n\n# 应用内核参数\nsudo sysctl --system"
}